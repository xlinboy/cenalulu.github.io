---
layout: article
title:  "Hbase底层架构"
categories: hbase
date:   2018-12-18 08:44:13
tags: hbase base grammer
---



## 1. 数据查找和传输

RDBMS和其他非关系型数据库底层存储结构的不同
> RDBMS所使用的架构并不局限于B树和B+树，也不是所有的NOSQL是LMS（Log-Structured Merge Tree）树。你将会看到各种技术被组合到一起，同时他们又服务于同一个目标：为当前的问题提供最好的存储结构。

### 2. B+树

#### 什么是B+树？
> 是一种数据结构。能够保证数据稳定有序，其插入与修改拥有较稳定的对数时间复杂度。B+ 树元素自底向上插入，这与二叉树恰好相反。

B+ 背后的想法是内部节点可以有在预定范围内的可变数目的子节点。因此，B+ 树不需要象其他自平衡二叉查找树那样经常的重新平衡。

#### B+树优势

- 能够通过主键对记录进行高效的插入、查找、以及删除。
    - 表示为动态、多层有上下界的索引 
- 大大减少查询特定主键所需要的IO操作。
- 叶节点相互连接并按主键有序，扫描时避免了耗时的遍历树操作。

##### B+树局限
在一颗B+树索引中，用户可以得到页表（也被称做块）级别的位置信息。  
例如，叶子节点页表如下：
```
[link to previous page]
[link to next page]
key1 -> rowid
key2 -> rowid
key3 -> rowid
```

对于固定页表，页表大小超过容量限制时，会将该页表拆分两个新的页表，同时更新原页表的父节点，并使用其指向刚创建的两个新节点。
![img](https://xlactive-1258062314.cos.ap-chengdu.myqcloud.com/B_Trees.PNG)
把键A-L连接到值 dA-dL 的B+树。   


此时问题是，两个新的页表在硬盘中并不一定是相邻的。


## LSM树

#### 什么是LSM树
> 存储引擎和B树存储引擎一样，同样支持增、删、读、改、顺序扫描操作。而且通过批量存储技术规避磁盘随机写入问题。

#### LSM树特点
- 输入的数据会首先存储在日志文件，这些文件内的数据完全有序。
- 有数据更改时，对应的更新会被保存在内存中加速查询。
- 经过多次修改，内存空间逐渐被占满时后，LSM树会把有序的“键-记录”对，flush到磁盘中，同时创建一个新的数据存储文件。以提高IO性能
- 存储文件的组织与B树相似，但LSM为了磁盘顺序读取做了优化，所有节点都是满的并按页存储。

![img](https://xlactive-1258062314.cos.ap-chengdu.myqcloud.com/LSM%E6%A0%91%E7%9A%84%E5%A4%9A%E9%A1%B5%E5%90%88%E5%B9%B6.PNG)
> 多次flush后会创建多个数据存储文件，后台进程就会自动将小文件聚合成大文件，这样磁盘查找就会被限制在少数几个文件中。 

- 查找时会先查找内存中的存储，然后在查找磁盘
- 删除是一种状态的更改，查找时会跳过这些标记过的键，合并时删除。

### LSM与B树对比：
> LSM树和B+树相比，LSM树牺牲了部分读性能，用来大幅提高写性能。

